import { Indicator } from './indicator';

describe('Indicator', () => {
  it('should compute Simple Moving Average', () => {
    expect(Indicator.SMA([5, 6, 7, 8, 9], 3)).toEqual([6, 7, 8]);
    expect(
      Indicator.SMA([100, 101, 100, 99, 102, 105, 106, 103, 102], 3),
    ).toEqual([
      100.33333333333333, 100, 100.33333333333333, 102, 104.33333333333333,
      104.66666666666667, 103.66666666666667,
    ]);
  });
  it('should compute Exponential Moving Average', () => {
    expect(Indicator.EMA([5, 6, 7, 8, 9], 3)).toEqual([6, 7, 8]);
    expect(
      Indicator.EMA([100, 101, 100, 99, 102, 105, 106, 103, 102], 3),
    ).toEqual([
      100.33333333333333, 99.66666666666666, 100.83333333333333,
      102.91666666666666, 104.45833333333333, 103.72916666666666,
      102.86458333333333,
    ]);
  });
  it('should compute Relative Moving Average', () => {
    expect(Indicator.RMA([5, 6, 7, 8, 9], 3)).toEqual([
      6, 6.666666666666666, 7.444444444444445,
    ]);
    expect(
      Indicator.RMA([100, 101, 100, 99, 102, 105, 106, 103, 102], 3),
    ).toEqual([
      100.33333333333333, 99.8888888888889, 100.59259259259261,
      102.06172839506175, 103.37448559670784, 103.2496570644719,
      102.83310470964794,
    ]);
  });
  it('should compute Bollinger Bands', () => {
    expect(
      Indicator.BollingerBands(
        [3000, 3010, 3020, 3030, 3040, 3000, 2950, 2960, 2970, 2980, 3050],
        3,
        2,
      ),
    ).toEqual({
      basis: [
        3010, 3020, 3030, 3023.3333333333335, 2996.6666666666665, 2970, 2960,
        2970, 3000,
      ],
      upper: [
        3030, 3040, 3050, 3064.966653322656, 3086.8516617231244,
        3022.915026221292, 2980, 2990, 3087.1779788708136,
      ],
      lower: [
        2990, 3000, 3010, 2981.700013344011, 2906.4816716102087,
        2917.084973778708, 2940, 2950, 2912.8220211291864,
      ],
    });
  });
  it('should compute MACD', () => {
    expect(
      Indicator.MACD(
        [3000, 3010, 3020, 3030, 3040, 3000, 2950, 2960, 2970, 2980, 3050],
        6,
        8,
        3,
      ),
    ).toEqual({
      macd: [-9.66187571022374, -3.1633425365007497],
      signal: [-12.098716155648617, -7.631029346074683],
      hist: [2.4368404454248775, 4.467686809573934],
    });
  });
  it('should compute RSI', () => {
    expect(
      Indicator.RSI(
        [3000, 3010, 3020, 3030, 3040, 3000, 2950, 2960, 2970, 2980, 3050],
        3,
      ),
    ).toEqual([
      100, 100, 33.33333333333333, 14.81481481481481, 26.984126984126974,
      39.869281045751634, 52.454780361757116, 85.13131313131314,
    ]);
  });
  it('should compute ATR', () => {
    expect(
      Indicator.ATR(
        [3000, 2990, 3010, 3060, 3030, 3035, 3055],
        [2940, 2970, 2970, 3000, 2970, 3020, 3025],
        [2950, 2980, 3000, 3020, 3020, 3025, 3030],
        3,
      ),
    ).toEqual([
      46.666666666666664, 51.11111111111111, 54.074074074074076,
      41.04938271604939, 37.36625514403293,
    ]);
  });

  it('should compute ADX', () => {
    expect(
      Indicator.ADX(
        [3000, 2990, 3010, 3060, 3030, 3035, 3055],
        [2940, 2970, 2970, 3000, 2970, 3020, 3025],
        [2950, 2980, 3000, 3020, 3020, 3025, 3030],
        3,
      ),
    ).toEqual([0, 0, 0, 0, 0, 50.15066724063711, 51.28324052601614]);
  });

  it('should compute SuperTrend', () => {
    expect(
      Indicator.SuperTrend(
        [3000, 2990, 3010, 3060, 3030, 3035, 3055],
        [2940, 2970, 2970, 3000, 2970, 3020, 3025],
        [2950, 2980, 3000, 3020, 3020, 3025, 3030],
        3,
        3,
      ),
    ).toEqual([
      2850, 2876.6666666666665, 2876.6666666666665, 2904.3518518518517,
      2927.901234567901,
    ]);
  });
});
